<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>TaladuGT - B·∫£n ƒë·ªì ch·ªâ ƒë∆∞·ªùng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.css" type="text/css">

  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
    .mapboxgl-ctrl-logo { display:block !important; }
    .taladu-logo {
      position:absolute; bottom:10px; right:10px;
      width:100px; z-index:2;
    }
    .control-buttons {
      position:absolute; top:10px; left:50%; transform:translateX(-50%);
      background:white; padding:5px; border-radius:6px;
      box-shadow:0 2px 5px rgba(0,0,0,0.3);
      z-index:2; font-family:sans-serif;
    }
    .control-buttons button {
      margin:2px; padding:5px 8px; cursor:pointer;
    }
    /* CSS cho n√∫t YouTube */
    .youtube-buttons {
      position:absolute; bottom:20px; left:20px;
      display:flex; gap:10px;
      z-index:2;
    }
    .youtube-buttons .btn {
      background: red;
      color: white;
      padding: 8px 20px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      font-weight: bold;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 120px;
      text-align: center;
    }
 .taladu-logo-wrap {
  position: absolute;
  bottom: 10px;
  right: 10px;
  display: flex;
  align-items: center;
  z-index: 2;
}

.at-symbol {
  font-size: 22px;      /* ch·ªânh to nh·ªè ch·ªØ @ */
  font-weight: bold;
  margin-right: 6px;    /* kho·∫£ng c√°ch gi·ªØa @ v√† logo */
  color: #000;          /* m√†u ch·ªØ @ */
}

.taladu-logo {
  width: 120px;         /* to nh·ªè logo */
  height: auto;
  border-radius: 50%;   /* gi·ªØ h√¨nh tr√≤n */
  object-fit: cover;
  box-shadow: 0 0 6px rgba(0,0,0,0.4);
}
 </style>
</head>
<body>
  <div id="map"></div>
  <div class="taladu-logo-wrap">
  <span class="at-symbol">@</span>
  <img src="taladugt-logo.png" class="taladu-logo" alt="TaladuGT">
</div>
  <!-- N√∫t ƒëi·ªÅu khi·ªÉn -->
  <div class="control-buttons">
    <button id="startBtn">‚ñ∂ B·∫Øt ƒë·∫ßu</button>
    <button id="pauseBtn">‚è∏ T·∫°m d·ª´ng</button>
    <button id="resumeBtn">‚èµ Ti·∫øp t·ª•c</button>
    <button id="stopBtn">‚èπ D·ª´ng</button>
    <button id="clearBtn">‚ùå X√≥a tuy·∫øn</button>
  </div>

  <!-- N√∫t k√™nh YouTube n·ªïi -->
  <div class="youtube-buttons">
    <a href="https://www.youtube.com/@DuNguyen-r3v" target="_blank" class="btn">üì∫ Xem k√™nh</a>
    <a href="https://www.youtube.com/@DuNguyen-r3v?sub_confirmation=1" target="_blank" class="btn">üîî ƒêƒÉng k√Ω k√™nh</a>
  </div>

  <script>
    // ===== C·∫§U H√åNH =====
    mapboxgl.accessToken = 'pk.eyJ1IjoidGFsYWR1IiwiYSI6ImNtZnFxM2l2azAxNjIya3M5Nm5xNnJkODAifQ.fm-nND4Ha2oxinfUlGDFOQ';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v12',
      center: [106.700981, 10.776889],
      zoom: 12
    });

    const directions = new MapboxDirections({
      accessToken: mapboxgl.accessToken,
      unit: 'metric',
      language: 'vi',
      profile: 'mapbox/driving',
      interactive: true
    });
    map.addControl(directions, 'top-left');
    map.addControl(new mapboxgl.NavigationControl(), 'top-right');

    // ===== XE DI CHUY·ªÇN =====
    let carMarker;
    let routeCoords = [];
    let animation;
    let step = 0;

    directions.on('route', (e) => {
      if (e.route.length) {
        const coords = e.route[0].geometry.coordinates;
        routeCoords = coords;
        step = 0;
        if (!carMarker) {
          carMarker = new mapboxgl.Marker({ color: 'red' })
            .setLngLat(coords[0])
            .addTo(map);
        } else {
          carMarker.setLngLat(coords[0]);
        }
      }
    });

    document.getElementById("startBtn").addEventListener("click", () => {
      if (!routeCoords || routeCoords.length === 0) {
        alert("Ch∆∞a c√≥ tuy·∫øn ƒë∆∞·ªùng! H√£y nh·∫≠p ƒëi·ªÉm ƒëi v√† ƒëi·ªÉm ƒë·∫øn.");
        return;
      }
      step = 0;
      carMarker.setLngLat(routeCoords[0]);
      if (animation) clearInterval(animation);
      animation = setInterval(() => {
        if (step < routeCoords.length) {
          carMarker.setLngLat(routeCoords[step]);
          map.panTo(routeCoords[step]);
          step++;
        } else {
          clearInterval(animation);
          alert("ƒê√£ ƒë·∫øn ƒëi·ªÉm ƒë·∫øn!");
        }
      }, 500);
    });

    document.getElementById("pauseBtn").addEventListener("click", () => {
      if (animation) clearInterval(animation);
    });

    document.getElementById("resumeBtn").addEventListener("click", () => {
      if (!routeCoords || step >= routeCoords.length) return;
      if (animation) clearInterval(animation);
      animation = setInterval(() => {
        if (step < routeCoords.length) {
          carMarker.setLngLat(routeCoords[step]);
          map.panTo(routeCoords[step]);
          step++;
        } else {
          clearInterval(animation);
          alert("ƒê√£ ƒë·∫øn ƒëi·ªÉm ƒë·∫øn!");
        }
      }, 500);
    });

    document.getElementById("stopBtn").addEventListener("click", () => {
      if (animation) clearInterval(animation);
      if (routeCoords.length > 0) {
        carMarker.setLngLat(routeCoords[0]);
        step = 0;
      }
    });

    document.getElementById("clearBtn").addEventListener("click", () => {
      if (animation) clearInterval(animation);
      directions.removeRoutes();
      routeCoords = [];
      step = 0;
      if (carMarker) carMarker.remove();
      carMarker = null;
    });

    // ===== ƒê·ªäA ƒêI·ªÇM =====
    const places = [
      {
        name: "Landmark 81",
        coords: [106.7217, 10.7942],
        youtube: "https://www.youtube.com/embed/LRoM0lOyo5g"
      },
      {
        name: "Ch·ª£ B·∫øn Th√†nh",
        coords: [106.6983, 10.7721],
        youtube: "https://www.youtube.com/embed/LRoM0lOyo5g"
      },
      {
        name: "Nh√† th·ªù ƒê·ª©c B√†",
        coords: [106.7009, 10.7798],
        youtube: "https://www.youtube.com/embed/LRoM0lOyo5g"
      }
    ];

    places.forEach(p => {
      const el = document.createElement('div');
      el.className = 'marker';
      el.style.backgroundImage = "url('https://cdn-icons-png.flaticon.com/512/1384/1384060.png')";
      el.style.width = "30px";
      el.style.height = "30px";
      el.style.backgroundSize = "cover";
      el.style.cursor = "pointer";

      new mapboxgl.Marker(el).setLngLat(p.coords)
        .setPopup(new mapboxgl.Popup().setHTML(`
          <h3>${p.name}</h3>
          <iframe width="320" height="200"
            src="${p.youtube}"
            frameborder="0"
            allowfullscreen>
          </iframe>
        `))
        .addTo(map);
    });
  </script>
</body>
</html>
